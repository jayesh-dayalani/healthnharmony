<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link href='https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.14/angular.min.js"></script>
</head>

<body>
    <div ng-app="coolform" class="wrapper">
        <img src="./logo.png" alt="Logo" class="logo">
        <div cool-form>
            <div class="q-title">Join the club!</div>
            <div ng-repeat="q in questions" class="question">
                <label>
                    <span class="q-text">
                        {{q.question}}
                        <span class="q-answer" ng-if="q.answer">
                            - {{q.answer}}
                        </span>
                    </span>
                    <!-- First dropdown for availing services -->
                    <select ng-if="q.question === 'Your availing services?'" ng-model="q.answer" ng-init="q.answer = servicesOptions[0].value"
                        ng-change="calculateSum()">
                        <option ng-repeat="option in servicesOptions" value="{{option.value}}">{{option.label}}</option>
                    </select>

                    <!-- Second dropdown for additional services -->
                    <select ng-if="q.question === 'Additional services?'" ng-model="q.answer" ng-init="q.answer = additionalOptions[0].value"
                        ng-change="calculateSum()">
                        <option ng-repeat="option in additionalOptions" value="{{option.value}}">{{option.label}}</option>
                    </select>

                    <!-- Third dropdown for payment gateway -->
                    <select ng-if="q.question === 'Payment Gateway?'" ng-model="q.answer" ng-init="q.answer = paymentOptions[0].value"
                        ng-change="calculateSum()">
                        <option ng-repeat="option in paymentOptions" value="{{option.value}}">{{option.label}}</option>
                    </select>

                    <!-- Text input for other questions -->
                    <div ng-if="!q.isSignature && q.question !== 'Your availing services?' && q.question !== 'Additional services?' && q.question !== 'Payment Gateway?'">
                        <input type="text" id="q{{$index}}" ng-model="q.answer">
                    </div>

                    <!-- Signature canvas -->
                    <div ng-if="q.isSignature">
                        <canvas id="signatureCanvas{{$index}}" width="400" height="150"></canvas>
                    </div>
                </label>
                <span class="q-next" ng-click="open($index+1)">></span>
            </div>
            <div class="q-after">
                <hr>
                <div class="q-confirm-text">Is the above information correct?</div>
                <div class="q-confirm-button"><a href="/index.html" ng-click="submitForm()">Cancle</a></div>
                <br>
                <div class="q-confirm-button"><a href="/index.html" ng-click="submitForm()">Upload</a></div>
            </div>


        </div>
        <!-- Display sum of selected services -->
        <div class="sum-display" ng-show="totalSum !== null">
            <h3>Total Selected Services Cost: {{ totalSum }}</h3>
        </div>
        <center ng-show="activequestion > -1 && activequestion < questions.length">{{activequestion+1}} / {{questions.length}}</center>
    </div>
    <div class="terms-conditions">
        <h2>Terms and Conditions</h2>
        <ol>
            <!-- Your terms and conditions list -->
            <li>**Assumption of Risk**: Participants acknowledge and assume all inherent risks of trampoline activities.</li>
            <li>**Waiver of Liability**: Visitors release the park from liability for injuries except in cases of gross negligence.</li>
            <li>**Age Restrictions**: Specific age limits apply, requiring minors to be supervised by an adult.</li>
            <li>**Health and Safety Compliance**: Adherence to all health and safety guidelines, including wearing proper attire, is mandatory.</li>
            <li>**Prohibited Activities**: Certain dangerous actions, like double bouncing or unsupervised flipping, are forbidden.</li>
            <li>**Personal Responsibility**: Visitors are responsible for their actions and must supervise any minors they bring.</li>
            <li>**Behavioral Standards**: Respectful, non-disruptive behavior is required at all times.</li>
            <li>**Medical Conditions**: Individuals with specific health issues may be advised or required not to participate.</li>
            <li>**Photo and Video Consent**: The park may use visitorsâ€™ images for promotional purposes without compensation.</li>
            <li>**Refund and Cancellation Policy**: Policies on refunds and cancellations, including non-refundable tickets, apply.</li>
        </ol>
    </div>
    <script>
        var coolform = angular.module('coolform', []);
        coolform
            .directive('coolForm', function ($timeout) {
                var ctrl = function ($scope, $element, $attributes) {
                    $scope.questions = [];
                    $scope.activequestion = -1;
                    $scope.answering = true;
                    $scope.totalSum = null;
                    $scope.formData = null;
                    $scope.showFormData = false;

                    $scope.servicesOptions = [
                        { label: 'Select Service', value: '' },
                        { label: '15 mins', value: '15 mins' },
                        { label: '30 mins', value: '30 mins' },
                        { label: '45 mins', value: '45 mins' },
                        { label: '60 mins', value: '60 mins' },
                        { label: '120 mins', value: '120 mins' }
                    ];

                    $scope.additionalOptions = [
                        { label: 'Select Service', value: '' },
                        { label: 'Socks XS', value: 'Socks XS' },
                        { label: 'Socks S', value: 'Socks S' },
                        { label: 'Socks M', value: 'Socks M' },
                        { label: 'Socks L', value: 'Socks L' },
                        { label: 'Socks XL', value: 'Socks XL' }
                    ];

                    $scope.paymentOptions = [
                        { label: 'Payment Mode', value: '' },
                        { label: 'Card', value: 'Card' },
                        { label: 'Cash', value: 'Cash' },
                        { label: 'UPI', value: 'UPI' }
                    ];

                    $scope.questions.push({ 'question': 'What\'s your name?' });
                    $scope.questions.push({ 'question': 'What\'s Contact No?' });
                    $scope.questions.push({ 'question': 'How old are you?' });
                    $scope.questions.push({ 'question': 'Where do you live?' });
                    $scope.questions.push({ 'question': 'Your availing services?' });
                    $scope.questions.push({ 'question': 'Additional services?' });
                    $scope.questions.push({ 'question': 'Payment Gateway?' });
                    $scope.questions.push({ 'question': 'Signature', 'isSignature': true });

                    function removeOpen() {
                        for (var i = 0; i < qs.length; i++) {
                            angular.element(qs[i]).removeClass('open');
                        }
                    }

                    var scrolle = document.getElementById('form-wrapper');
                    var qs = document.getElementsByClassName('question');

                    $scope.open = function (order) {
                        removeOpen();
                        if (order >= $scope.questions.length || order < 0) {
                            $scope.answering = false;
                            if ($element.hasClass('answering')) {
                                $element.removeClass('answering');
                                $scope.activequestion = $scope.questions.length + 1;
                            }
                        } else {
                            $scope.answering = true;
                            if (!$element.hasClass('answering')) {
                                $element.addClass('answering');
                            }
                            $scope.activequestion = order;
                            var offset = qs[0].offsetTop;
                            if (order !== 0) { offset = qs[order - 1].offsetTop; }
                            scrollToAndFocus(scrolle, offset, 500, $scope.questions[order]);
                            if (!angular.element(qs[order]).hasClass('open')) {
                                angular.element(qs[order]).addClass('open');
                            }
                            if ($scope.questions[order].isSignature) {
                                initializeSignatureCanvas('signatureCanvas' + order);
                            }
                        }
                    }

                    function scrollToAndFocus(element, to, duration, focus) {
                        if (duration <= 10) {
                            if (!focus.isSignature) {
                                document.getElementById('q' + (focus)).focus();
                            }
                            return;
                        }
                        var difference = to - element.scrollTop;
                        var perTick = difference / duration * 10;
                        window.setTimeout(function () {
                            element.scrollTop = element.scrollTop + perTick;
                            if (element.scrollTop === to) return;
                            scrollToAndFocus(element, to, duration - 10, focus);
                        }, 10);
                    }

                    $scope.calculateSum = function () {
                        var sum = 0;
                        for (var i = 0; i < $scope.questions.length; i++) {
                            var q = $scope.questions[i];
                            if (q.question === 'Your availing services?' || q.question === 'Additional services?') {
                                sum += getServiceCost(q.answer);
                            }
                        }
                        $scope.totalSum = sum;
                    };

                    function getServiceCost(service) {
                        switch (service) {
                            case '15 mins':
                                return 10;
                            case '30 mins':
                                return 20;
                            case '45 mins':
                                return 30;
                            case '60 mins':
                                return 40;
                            case '120 mins':
                                return 50;
                            case 'Socks XS':
                                return 5;
                            case 'Socks S':
                                return 15;
                            case 'Socks M':
                                return 25;
                            case 'Socks L':
                                return 35;
                            case 'Socks XL':
                                return 45;
                            default:
                                return 0;
                        }
                    }

                    $scope.submitForm = function () {
                        var formData = angular.copy($scope.questions);
                        $scope.formData = {
                            questions: formData,
                            totalSum: $scope.totalSum
                        };
                        $scope.showFormData = true;
                        console.log($scope.formData);
                    };

                    var handler = function (e) {
                        if (e.keyCode === 37 || e.keyCode === 39 || e.keyCode === 13 || e.keyCode === 9) {
                            e.preventDefault();
                            $scope.$apply(function () {
                                $scope.open($scope.activequestion + 1);
                            });
                        }
                    };

                    $element.on('keydown', handler);
                    $scope.$on('$destroy', function () {
                        $element.off('keydown', handler);
                    });

                    setTimeout(function () {
                        $scope.activequestion++;
                        $scope.$apply(function () {
                            $scope.open($scope.activequestion);
                        });
                    }, 2000);
                };
                return {
                    restrict: 'EA',
                    replace: true,
                    transclude: true,
                    link: ctrl,
                    template: '<div ng-transclude id="form-wrapper" class="answering"></div>'
                };
            });

        function initializeSignatureCanvas(canvasId) {
            var canvas = document.getElementById(canvasId);
            var ctx = canvas.getContext('2d');
            var drawing = false;

            canvas.addEventListener('mousedown', function (e) {
                drawing = true;
                ctx.moveTo(e.offsetX, e.offsetY);
            });

            canvas.addEventListener('mousemove', function (e) {
                if (drawing) {
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.stroke();
                }
            });

            canvas.addEventListener('mouseup', function () {
                drawing = false;
            });

            canvas.addEventListener('mouseout', function () {
                drawing = false;
            });
        }
    </script>
</body>

</html>
