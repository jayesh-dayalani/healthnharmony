<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link href='https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.14/angular.min.js"></script>
</head>

<body>
    <div ng-app="coolform" class="wrapper">
        <img src="./logo.png" alt="Logo" class="logo">
        <div cool-form>
            <div class="q-title">Join the club!</div>
            <div ng-repeat="q in questions" class="question">
                <label>
                    <span class="q-text">
                        {{q.question}}
                        <span class="q-answer">
                            {{q.answer}}
                        </span>
                    </span>
                    <input type="text" ng-if="!q.isSignature" id="q{{$index}}" ng-model="q.answer">
                    <div ng-if="q.isSignature">
                        <canvas id="signatureCanvas{{$index}}" width="400" height="150"></canvas>
                    </div>
                </label>
                <span class="q-next" ng-click="open($index+1)">></span>
            </div>
            <div class="q-after">
                <hr>
                <div class="q-confirm-text">Is the above information correct?</div>
                <div class="q-confirm-button"><a href="/index.html" style="text-decoration: none;">Absolutely</a></div>
            </div>
        </div>
        <center ng-show="activequestion > -1 && activequestion < questions.length">{{activequestion+1}} / {{questions.length}}</center>
    </div>
    <div class="terms-conditions">
        <h2>Terms and Conditions</h2>
        <ol>
            <li>All participants must sign a waiver before using the trampoline park.</li>
            <li>Participants under the age of 18 must have a waiver signed by a parent or guardian.</li>
            <li>Proper trampoline park socks must be worn at all times.</li>
            <li>No rough play, pushing, or shoving is allowed in the trampoline park.</li>
            <li>Follow all staff instructions at all times for your safety.</li>
            <li>Do not attempt flips or tricks beyond your skill level.</li>
            <li>Only one person is allowed on a trampoline at a time.</li>
            <li>No running on or around the trampolines.</li>
            <li>All personal belongings must be stored in lockers or designated areas.</li>
            <li>The trampoline park is not responsible for lost or stolen items.</li>
        </ol>
    </div>
    <script>
        var coolform = angular.module('coolform', []);
        coolform
            .directive('coolForm', function ($timeout) {
                var ctrl = function ($scope, $element, $attributes) {
                    $scope.questions = [];
                    $scope.activequestion = -1;
                    $scope.answering = true;

                    $scope.questions.push({ 'question': 'What\'s your name?' });
                    $scope.questions.push({ 'question': 'What\'s Contact No?' });
                    $scope.questions.push({ 'question': 'How old are you?' });
                    $scope.questions.push({ 'question': 'Where do you live?' });
                    $scope.questions.push({ 'question': 'Signature', 'isSignature': true });

                    function removeOpen() {
                        for (i = 0; i < qs.length; i++) {
                            angular.element(qs[i]).removeClass('open');
                        }
                    }

                    var scrolle = document.getElementById('form-wrapper');
                    var qs = document.getElementsByClassName('question');

                    $scope.open = function (order) {
                        removeOpen();
                        if (order >= $scope.questions.length || order < 0) {
                            $scope.answering = false;
                            if ($element.hasClass('answering')) {
                                $element.removeClass('answering');
                                $scope.activequestion = $scope.questions.length + 1;
                            }
                        } else {
                            $scope.answering = true;
                            if (!$element.hasClass('answering')) {
                                $element.addClass('answering');
                            }
                            $scope.activequestion = order;
                            var offset = qs[0].offsetTop;
                            if (order !== 0) { offset = qs[order - 1].offsetTop; }
                            scrollToAndFocus(scrolle, offset, 500, $scope.questions[order]);
                            if (!angular.element(qs[order]).hasClass('open')) {
                                angular.element(qs[order]).addClass('open');
                            }
                            if ($scope.questions[order].isSignature) {
                                initializeSignatureCanvas('signatureCanvas' + order);
                            }
                        }
                    }

                    function scrollToAndFocus(element, to, duration, focus) {
                        if (duration <= 10) {
                            if (!focus.isSignature) {
                                document.getElementById('q' + (focus)).focus();
                            }
                            return;
                        }
                        var difference = to - element.scrollTop;
                        var perTick = difference / duration * 10;
                        window.setTimeout(function () {
                            element.scrollTop = element.scrollTop + perTick;
                            if (element.scrollTop === to) return;
                            scrollToAndFocus(element, to, duration - 10, focus);
                        }, 10);
                    }

                    var handler = function (e) {
                        if (e.keyCode === 37) {
                            e.preventDefault();
                            $scope.$apply(function () {
                                $scope.open($scope.activequestion - 1);
                            });
                        }
                        if (e.keyCode === 39) {
                            e.preventDefault();
                            $scope.$apply(function () {
                                $scope.open($scope.activequestion + 1);
                            });
                        }
                        if (e.keyCode === 13) {
                            e.preventDefault();
                            $scope.$apply(function () {
                                $scope.open($scope.activequestion + 1);
                            });
                        }
                        if (e.keyCode == 9) {
                            e.preventDefault();
                            $scope.$apply(function () {
                                $scope.open($scope.activequestion + 1);
                            });
                        }
                    };

                    $element.on('keydown', handler);
                    $scope.$on('$destroy', function () {
                        $element.off('keydown', handler);
                    });

                    setTimeout(function () {
                        $scope.activequestion++;
                        $scope.$apply(function () {
                            $scope.open($scope.activequestion);
                        });
                    }, 2000);
                };
                return {
                    restrict: 'EA',
                    replace: true,
                    transclude: true,
                    link: ctrl,
                    template: '<div ng-transclude id="form-wrapper" class="answering"></div>'
                };
            });

        function initializeSignatureCanvas(canvasId) {
            var canvas = document.getElementById(canvasId);
            var ctx = canvas.getContext('2d');
            var drawing = false;

            canvas.addEventListener('mousedown', function (e) {
                drawing = true;
                ctx.moveTo(e.offsetX, e.offsetY);
            });

            canvas.addEventListener('mousemove', function (e) {
                if (drawing) {
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.stroke();
                }
            });

            canvas.addEventListener('mouseup', function () {
                drawing = false;
            });

            canvas.addEventListener('mouseout', function () {
                drawing = false;
            });
        }

        coolform.controller('FormController', ['$scope', function ($scope) {
            $scope.clearSignature = function (canvasId) {
                var canvas = document.getElementById(canvasId);
                var ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            };
        }]);
    </script>
</body>

</html>
